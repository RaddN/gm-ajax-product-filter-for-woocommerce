jQuery(document).ready(function(e){let t,l,i,n=m();"undefined"!=typeof dapfforwc_data&&dapfforwc_data.dapfforwc_front_page_slug&&(i=dapfforwc_data.dapfforwc_front_page_slug),"undefined"!=typeof dapfforwc_data&&dapfforwc_data.dapfforwc_options&&(l=dapfforwc_data.dapfforwc_options),"undefined"!=typeof dapfforwc_data&&dapfforwc_data.dapfforwc_advance_settings&&(t=dapfforwc_data.dapfforwc_advance_settings);var r,o=e(".rfilterbuttons").attr("id");E(),e("#product-filter, .rfilterbuttons").on("change",v),e("#product-filter, .rfilterbuttons").on("submit",v),e(".woocommerce-ordering select").on("change",function(t){t.preventDefault(),r=e(this).val(),_()}),e(".woocommerce-ordering").on("submit",function(e){e.preventDefault()});var c=window.location.href,u=window.location.pathname,a="/"===u?i:u.replace(/^\/|\/$/g,"");c=c.split("?")[0];let p=new URLSearchParams(window.location.search),s=p.get("filters");if("undefined"!=typeof dapfforwc_data&&dapfforwc_data.slug){let f=dapfforwc_data.slug.split("/").filter(e=>""!==e);if(f.length>0){let d=f.join(",");D(d),z()}}else if(s){let h=s.split("/").filter(e=>""!==e);if(h.length>0){let g=h.join(",");D(g),z()}}else y()&&_();function v(t){if(t.preventDefault(),n=m(),z(),!y())return location.reload();L(),e("#roverlay").show(),e("#loader").show(),_()}function m(){let t=[];return t=t.concat(e("#product-filter input:checked").map(function(){return e(this).val()}).get()),e("#product-filter select").each(function(){let l=e(this).val();l&&(t=t.concat(l))}),t}function $(){a&&a.split("/").forEach(t=>{e(`input[value="${t}"]`).length?e(`input[value="${t}"]`).attr("checked",!0):e(`select option[value="${t}"]`).length&&e(`select option[value="${t}"]`).prop("selected",!0)})}function y(){let t=e("#product-filter input:checked").length>0,l=e("#product-filter select").filter(function(){return this.value}).length>0,i=e('#product-filter input[type="text"]').filter(function(){return""!==this.value.trim()}).length>0,n=e('#product-filter input[type="number"]').filter(function(){return""!==this.value.trim()}).length>0,r=e('#product-filter input[type="range"]').filter(function(){return""!==this.value.trim()}).length>0;return t||l||i||n||r}$();let k=t?t.product_selector??"ul.products":"ul.products",x=t?t.pagination_selector??"ul.page-numbers":"ul.page-numbers",b=e("#product-filter").data("product_selector"),w=e("#product-filter").data("pagination_selector");function _(t=1){$(),n=m(),e.post(dapfforwc_ajax.ajax_url,function t(){let l="/"===u?u:u.replace(/^\/|\/$/g,""),i=e("#product-filter").serialize(),n=document.querySelectorAll(".range-input input"),r=document.querySelectorAll(".price-input input"),o=document.querySelector(".slider .progress"),c=n[0]?parseInt(n[0].value):0,a=n[1]?parseInt(n[1].value):0,p=n[0].min?parseInt(n[0].min):0;C(`$${c}`,`$${a}`),n.forEach(e=>{e.addEventListener("input",e=>{c=parseInt(n[0].value)||0,a=parseInt(n[1].value)||0,C(`$${c}`,`$${a}`),r[0].value=c,r[1].value=a,o.style.left=(c-p)/(n[0].max-p)*100+"%",o.style.right=100-a/n[1].max*100+"%"})}),r.forEach(e=>{e.addEventListener("input",e=>{let t=parseInt(r[0].value),l=parseInt(r[1].value);"input-min"===e.target.className?(n[0].value=t,o.style.left=t/n[0].max*100+"%"):(n[1].value=l,o.style.right=100-l/n[1].max*100+"%")})});let s="";return c&&(s+=`&min_price=${encodeURIComponent(c)}`),a&&(s+=`&max_price=${encodeURIComponent(a)}`),console.log(i),i+s+`&current-page=${encodeURIComponent(l)}`}()+`&selectedvalues=${n}&orderby=${r}&paged=${t}&action=dapfforwc_filter_products`,function(t){e("#roverlay").hide(),e("#loader").hide(),t.success?(e(b??k).html(t.data.products),e(".woocommerce-result-count").text(`${t.data.total_product_fetch} results found`),e("#rcountproduct").text(`show(${t.data.total_product_fetch})`),"on"===l.update_filter_options&&"undefined"==typeof updatefilteroptions&&(e("#product-filter div").remove(),e("form#product-filter").append(t.data.filter_options),e(document).ajaxComplete(function(){e(".select2").select2({placeholder:"Select Options",allowClear:!0}),e("select.select2_classic").select2({placeholder:"Select Options",allowClear:!0})})),e(w??x).html(t.data.pagination),E()):console.error("Error:",t.message)}).fail(S)}function j(){e(".show-sub-cata").on("click",function(t){t.preventDefault();let l=e(this).closest("a").next(".child-categories");l.slideToggle(()=>{e(this).text(l.is(":visible")?"-":"+")})})}function C(t,l){var i=e("<style></style>");i.text(`
            .progress-percentage:before { 
                content: "${t}"; 
            }
            .progress-percentage:after { 
                content: "${l}"; 
            }
        `),e("head").append(i)}function S(t,l,i){e("#roverlay").hide(),e("#loader").hide(),console.error("AJAX Error:",l,i)}function E(){let t=e(".rfilterbuttons ul").empty();e("#product-filter #"+o+" input").each(function(){let l=e(this).val(),i=e(this).is(":checked"),n=this.type;t.append(A(l,i,n))}),e("#product-filter #"+o+" option").each(function(l){if(0===l)return;let i=e(this).val(),n=e(this).is(":checked"),r=this.type;t.append(A(i,n,r))}),e(".rfilterbuttons ul").off("click","li").on("click","li",function(){let t=e(this).find("input");t.prop("checked",!t.is(":checked")).trigger("change"),e(this).toggleClass("checked",t.is(":checked"))}),e("#"+o+" input").on("change",function(){let t=e(`.rfilterbuttons ul li input[value="${e(this).val()}"]`);t.prop("checked",e(this).is(":checked")).closest("li").toggleClass("checked",e(this).is(":checked"))})}function A(t,l,i){let n=t.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");return e("<li></li>").addClass(l?"checked":"").append(e("<input>",{name:"attribute["+o+"][]",id:"text_"+t,type:"checkbox",value:t,checked:l}).on("change",q),e("<label></label>",{for:"text_"+t,text:n}))}function q(){let t=e(this).val(),l=e(this).is(":checked")||e(this).is(":selected");e(`#product-filter #${o} input[value="${t}"]`).prop("checked",l),e(`#product-filter #${o} select option[value="${t}"]`).prop("selected",l)}function D(t){if(!t)return;let l=t.split(",").map(e=>e.trim());l.forEach(t=>{e(`input[value="${t}"]`).length?e(`input[value="${t}"]`).attr("checked",!0):e(`select option[value="${t}"]`).length?e(`select option[value="${t}"]`).prop("selected",!0):console.log(`Filter "${t}" not found in inputs or dropdown.`)}),_()}function z(){let t=new Set;e("#product-filter input:checked").each(function(){t.add(e(this).val())}),e("#product-filter select").each(function(){e(this).find("option:selected").each(function(){t.add(e(this).val())})});let i=Array.from(t).filter(Boolean);if("undefined"!=typeof dapfforwc_data&&dapfforwc_data.dapfforwc_options){let n=dapfforwc_data.dapfforwc_options;if(n.default_filters){var r=n.default_filters[a]??[];let o=a.split("/");(r=r.concat(o))&&(i=i.filter(function(e){return!r.includes(e)}))}}let u=l&&"on"===l.use_filters_word_in_permalinks?"filters/":"",p=c?0!==i.length?`${c}${u}${i.join("/")}`:`${c}${i.join("/")}`:`${i.join("/")}`;history.replaceState(null,"",p)}function L(){for(let t of(e(".rfilterselected ul").empty(),n))e(".rfilterselected ul").append(`
            <li class="checked">
                <input id="selected_${t}" type="checkbox" value="${t}" checked>
                <label for="selected_${t}">${t.replace(/-/g," ")}</label>
                <label style="font-size:12px;margin-left:5px;">x</label>
            </li>`)}function N(){return 768>=e(window).width()}function O(){N()&&(e("#product-filter .filter-group div .title").each(function(){e(this).text(e(this).text().split(" ").pop())}),e("#product-filter .items").hide())}function P(){2===e("form#product-filter").children().length&&(e(b??k).html("<p>No products found</p>"),e(w??x).html(""))}j(),"on"===l.update_filter_options&&"undefined"==typeof updatefilteroptions&&e(document).ajaxComplete(function(){j()}),e("#product-filter").length&&e(document).on("click",` ${w??x} a.page-numbers`,function(t){t.preventDefault();let l=e(this).attr("href"),i=new URL(l).searchParams.get("paged");e("#roverlay").show(),e("#loader").show(),_(i)}),e(document).on("click","#reset-rating",function(t){t.preventDefault(),e('input[name="rating[]"]').prop("checked",!1),_(),z()}),L(),e(".rfilterselected").on("change","li",function(t){let l=e(this).find('input[type="checkbox"]').val();e(`#product-filter input[value="${l}"]`).prop("checked",!1),v(t)}),O(),e(document).ajaxComplete(function(){O(),P();let e=document.querySelectorAll(".range-input input"),t=(document.querySelectorAll(".price-input input"),document.querySelector(".slider .progress")),l=e[0].min?parseInt(e[0].min):0,i=parseInt(e[0].value)||0,n=parseInt(e[1].value)||0;t.style.left=(i-l)/(e[0].max-l)*100+"%",t.style.right=100-n/e[1].max*100+"%"}),e("#product-filter").on("click",".title",function(t){N()&&(t.stopPropagation(),e("#product-filter .items").hide(),e(this).next(".items").slideToggle())}),e(document).on("click",function(){N()&&e(".items").hide()}),P()});